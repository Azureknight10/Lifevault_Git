  <script>
    const circle = document.getElementById('circle');
    const water = document.getElementById('water');
    const circleText = document.getElementById('circleText');
    let holdTimer = null;
    let fillInterval = null;
    const HOLD_DURATION = 5000;

    function startFilling() {
      let startTime = Date.now();
      fillInterval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / HOLD_DURATION, 1);
        water.style.height = (progress * 100) + '%';
        const secondsLeft = Math.ceil((HOLD_DURATION - elapsed) / 1000);
        circleText.textContent = secondsLeft > 0 ? secondsLeft + 's' : 'Opening...';
      }, 50);
      holdTimer = setTimeout(() => { window.location.href = 'resources.html'; }, HOLD_DURATION);
    }

    function stopFilling() {
      if (holdTimer) { clearTimeout(holdTimer); holdTimer = null; }
      if (fillInterval) { clearInterval(fillInterval); fillInterval = null; }
      water.style.height = '0%';
      circleText.textContent = 'Hold to Enter';
    }

    circle.addEventListener('mousedown', (e) => { e.preventDefault(); startFilling(); });
    circle.addEventListener('mouseup', stopFilling);
    circle.addEventListener('mouseleave', stopFilling);
    circle.addEventListener('touchstart', (e) => { e.preventDefault(); startFilling(); });
    circle.addEventListener('touchend', stopFilling);

    const breathingCircle = document.getElementById('breathingCircle');
    const breathingVisual = document.getElementById('breathingVisual');
    const breathingText = document.getElementById('breathingText');
    let breathingInterval = null;
    let breathCount = 0;
    const MAX_BREATHS = 30;

    function startBreathing() {
      breathCount = 0;
      let isInhaling = true;
      let cycleStart = Date.now();
      breathingInterval = setInterval(() => {
        const elapsed = Date.now() - cycleStart;
        if (isInhaling) {
          breathingVisual.classList.add('inhale');
          breathingVisual.classList.remove('exhale');
          breathingText.textContent = `Inhale\n${breathCount}/${MAX_BREATHS}`;
          if (elapsed >= 500) { isInhaling = false; cycleStart = Date.now(); }
        } else {
          breathingVisual.classList.add('exhale');
          breathingVisual.classList.remove('inhale');
          breathingText.textContent = `Exhale\n${breathCount}/${MAX_BREATHS}`;
          if (elapsed >= 500) {
            isInhaling = true;
            cycleStart = Date.now();
            breathCount++;
            if (breathCount >= MAX_BREATHS) stopBreathing(true);
          }
        }
      }, 50);
    }

    function stopBreathing(completed = false) {
      if (breathingInterval) { 
        clearInterval(breathingInterval); 
        breathingInterval = null;
      }
      breathingVisual.classList.remove('inhale', 'exhale');
      if (completed) {
        breathingText.textContent = 'Complete!\nRest & Breathe';
        setTimeout(() => { breathingText.textContent = 'Hold to Breathe'; }, 5000);
      } else {
        breathingText.textContent = 'Hold to Breathe';
      }
      breathCount = 0;
    }

    breathingCircle.addEventListener('mousedown', (e) => { e.preventDefault(); if (!breathingInterval) startBreathing(); });
    breathingCircle.addEventListener('mouseup', () => { if (breathCount < MAX_BREATHS) stopBreathing(false); });
    breathingCircle.addEventListener('mouseleave', () => { if (breathCount < MAX_BREATHS) stopBreathing(false); });
    breathingCircle.addEventListener('touchstart', (e) => { e.preventDefault(); if (!breathingInterval) startBreathing(); });
    breathingCircle.addEventListener('touchend', () => { if (breathCount < MAX_BREATHS) stopBreathing(false); });

    const gratitudeCircle = document.getElementById('gratitudeCircle');
    const gratitudeGlow = document.getElementById('gratitudeGlow');
    const gratitudeText = document.getElementById('gratitudeText');
    const prompts = [
      "Name someone who helped you grow", "What challenge taught you something today?", "What small victory did you have?",
      "What strength did you use today?", "What made you smile recently?", "Who showed you kindness today?",
      "What part of your body are you grateful for?", "What skill have you developed?", "What comfort do you have that others may not?",
      "What opportunity came your way?", "What lesson did failure teach you?", "What relationship brings you peace?",
      "What habit is improving your life?", "What do you love about where you live?", "What technology makes your life easier?",
      "What food nourished you today?", "What creative expression did you enjoy?", "What wisdom did you gain this week?"
    ];
    let gratitudeInterval = null;
    let promptIndex = 0;
    let selectedPrompts = [];

    function startGratitude() {
      selectedPrompts = [...prompts].sort(() => Math.random() - 0.5).slice(0, 3);
      promptIndex = 0;
      gratitudeGlow.classList.add('active');
      gratitudeText.textContent = selectedPrompts[0];
      promptIndex = 1;
      gratitudeInterval = setInterval(() => {
        if (promptIndex < 3) {
          gratitudeText.textContent = selectedPrompts[promptIndex];
          promptIndex++;
        } else {
          stopGratitude(true);
        }
      }, 3000);
    }

    function stopGratitude(completed = false) {
      if (gratitudeInterval) { 
        clearInterval(gratitudeInterval); 
        gratitudeInterval = null;
      }
      gratitudeGlow.classList.remove('active');
      if (completed) {
        gratitudeText.textContent = 'Reflect on these...';
        setTimeout(() => { gratitudeText.textContent = 'Hold for Gratitude'; }, 3000);
      } else {
        gratitudeText.textContent = 'Hold for Gratitude';
      }
      promptIndex = 0;
      selectedPrompts = [];
    }

    gratitudeCircle.addEventListener('mousedown', (e) => { e.preventDefault(); if (!gratitudeInterval) startGratitude(); });
    gratitudeCircle.addEventListener('mouseup', () => { if (promptIndex < 3) stopGratitude(false); });
    gratitudeCircle.addEventListener('mouseleave', () => { if (promptIndex < 3) stopGratitude(false); });
    gratitudeCircle.addEventListener('touchstart', (e) => { e.preventDefault(); if (!gratitudeInterval) startGratitude(); });
    gratitudeCircle.addEventListener('touchend', () => { if (promptIndex < 3) stopGratitude(false); });
  </script>
