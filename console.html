<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LifeVault Console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { box-sizing: border-box; }

        :root {
            --bg: #020617;
            --bg-gradient: radial-gradient(circle at top, #1d283a 0, #020617 55%);
            --glass: rgba(15, 23, 42, 0.78);
            --glass-border: rgba(148, 163, 184, 0.18);
            --glass-shadow: 0 18px 40px rgba(15, 23, 42, 0.85);
            --accent: #38bdf8;
            --accent-soft: rgba(56, 189, 248, 0.25);
            --accent-strong: rgba(56, 189, 248, 0.65);
            --text-main: #e5e7eb;
            --text-subtle: #9ca3af;
            --pill-bg: rgba(15, 23, 42, 0.9);
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at 0% -20%, rgba(56, 189, 248, 0.12) 0, transparent 55%),
                radial-gradient(circle at 100% 120%, rgba(94, 234, 212, 0.16) 0, transparent 55%),
                var(--bg-gradient);
            color: var(--text-main);
            min-height: 100vh;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 20;
            padding: 16px 24px;
            border-bottom: 1px solid rgba(31, 41, 55, 0.85);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(to bottom, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.86));
            backdrop-filter: blur(22px);
        }

        header h1 {
            margin: 0;
            font-size: 20px;
            letter-spacing: 0.03em;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        header h1 span.logo-dot {
            width: 9px;
            height: 9px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 20%, #e0f2fe 0, #38bdf8 45%, #0ea5e9 100%);
            box-shadow: 0 0 24px rgba(56, 189, 248, 0.8);
        }

        header .env-pill {
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            color: var(--text-subtle);
            background: var(--pill-bg);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        header .env-pill::before {
            content: "";
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 20%, #bbf7d0 0, #22c55e 50%, #16a34a 100%);
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
        }

        main {
            display: grid;
            grid-template-columns: minmax(0, 1.15fr) minmax(0, 1.05fr);
            gap: 18px;
            padding: 18px 24px 32px;
        }

        @media (max-width: 1100px) {
            main {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.86), rgba(15, 23, 42, 0.78));
            border-radius: 18px;
            border: 1px solid var(--glass-border);
            padding: 16px 16px 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(18px);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: "";
            position: absolute;
            inset: -1px;
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.18);
            pointer-events: none;
        }

        .panel h2 {
            margin: 0 0 4px 0;
            font-size: 15px;
            color: #f9fafb;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .panel h2 span.pill {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: var(--text-subtle);
            text-transform: none;
        }

        label {
            font-size: 12px;
            color: #cbd5f5;
            display: block;
            margin-bottom: 5px;
        }

        textarea, select, input[type="text"] {
            width: 100%;
            border-radius: 10px;
            border: 1px solid rgba(30, 64, 175, 0.45);
            background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
            color: #f9fafb;
            padding: 9px 11px;
            font-size: 14px;
            outline: none;
            transition: border-color 120ms ease, box-shadow 120ms ease, background-color 120ms ease;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        select {
            height: 36px;
        }

        textarea:focus,
        select:focus,
        input[type="text"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
            background: radial-gradient(circle at top, rgba(15, 23, 42, 0.99), rgba(15, 23, 42, 0.97));
        }

        button {
            border-radius: 999px;
            border: none;
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease, border-color 120ms ease, color 120ms ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: radial-gradient(circle at 10% 0, var(--accent-strong), #0ea5e9);
            color: #f9fafb;
            box-shadow: 0 12px 32px rgba(56, 189, 248, 0.35);
            border: 1px solid rgba(56, 189, 248, 0.5);
        }

        .btn-primary:hover {
            transform: translateY(-0.5px);
            box-shadow: 0 16px 40px rgba(56, 189, 248, 0.5);
        }

        .btn-primary:active {
            transform: translateY(0.5px);
            box-shadow: 0 8px 24px rgba(56, 189, 248, 0.35);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-outline {
            background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
            color: var(--text-main);
            border: 1px solid rgba(148, 163, 184, 0.4);
        }

        .btn-outline:hover {
            border-color: rgba(148, 163, 184, 0.7);
            transform: translateY(-0.5px);
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .row > div {
            flex: 1;
        }

        .status {
            font-size: 11px;
            color: var(--text-subtle);
        }

        .response-box {
            background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.96));
            border-radius: 12px;
            border: 1px solid rgba(30, 64, 175, 0.45);
            padding: 10px 11px;
            min-height: 120px;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.45;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 11px;
            background: radial-gradient(circle at top, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
            color: #cbd5f5;
            border: 1px solid rgba(148, 163, 184, 0.35);
            margin-right: 4px;
            margin-bottom: 4px;
        }

        .badge::before {
            content: "";
            width: 5px;
            height: 5px;
            border-radius: 999px;
            background: var(--accent);
        }

        .small-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #9fa6c9;
        }
    </style>
</head>
<body>
<header>
    <h1>
        <span class="logo-dot"></span>
        LifeVault Console
    </h1>
    <div class="env-pill">Frontend → Orchestrator · Vitality · Fasting</div>
</header>

<main>
    <!-- Fasting Tracker -->
    <section class="panel">
        <h2>
            Fasting Tracker
            <span class="pill">Metabolic timeline</span>
        </h2>

        <div class="row" style="justify-content: space-between; align-items: center;">
            <button id="startFastBtn" class="btn-primary">
                Start fast
            </button>
            <button id="endFastBtn" class="btn-outline">
                End fast
            </button>
        </div>

        <div class="status" id="fastStatus">Not fasting.</div>

        <div>
            <div class="small-label">Current fasting stage</div>
            <div id="fastStage" class="response-box">
                When you start a fast, you’ll see a time‑aligned description of what’s happening in your body across the fast.
            </div>
        </div>
    </section>

    <!-- Quick Meal Log -->
    <section class="panel">
        <h2>
            Quick Meal Log
            <span class="pill">Direct to Azure · MealLog</span>
        </h2>

        <div class="row">
            <div>
                <label for="mealType">Meal type</label>
                <select id="mealType">
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                    <option value="snack">Snack</option>
                </select>
            </div>
            <div>
                <label for="mealUserId">User ID</label>
                <input id="mealUserId" type="text" placeholder="defaultuser">
            </div>
        </div>

        <div>
            <label for="mealItems">What did you eat?</label>
            <input id="mealItems" type="text"
                   placeholder="Example: 3 eggs, avocado, black coffee">
        </div>

        <div class="row" style="justify-content: space-between; align-items: center;">
            <button id="mealLogBtn" class="btn-primary">Log meal</button>
            <div class="status" id="mealStatus">Idle</div>
        </div>
    </section>

    <!-- LEFT: Request builder -->
    <section class="panel">
        <h2>
            Orchestrator Request
            <span class="pill">Multi‑agent planner</span>
        </h2>

        <div>
            <label for="inputText">What do you want LifeVault to do?</label>
            <textarea id="inputText"
                      placeholder="Example: Plan my next 7 days to balance coding, workouts, and recovery."></textarea>
        </div>

        <div class="row">
            <div>
                <label for="persona">Persona</label>
                <select id="persona">
                    <option value="dev">Developer Shane</option>
                    <option value="vitality">Vitality Shane</option>
                    <option value="wisdom">Wisdom Shane</option>
                </select>
            </div>
            <div>
                <label for="intent">Intent</label>
                <select id="intent">
                    <option value="plan_day">Plan day</option>
                    <option value="plan_sprint">Plan dev sprint</option>
                    <option value="optimize_energy">Optimize energy</option>
                    <option value="reflect">Reflect / wisdom</option>
                    <option value="log_event">Log event</option>
                    <option value="big_decision">Big decision</option>
                </select>
            </div>
        </div>

        <div>
            <label for="userId">User ID (optional)</label>
            <input id="userId" type="text" placeholder="e.g., shane-dev-001">
        </div>

        <div class="row" style="justify-content: space-between; align-items: center;">
            <button id="runBtn" class="btn-primary">Run with LifeVault</button>
            <button id="exampleBtn" class="btn-outline">Use example request</button>
        </div>

        <div class="status" id="statusText">Idle</div>
    </section>

    <!-- RIGHT: Response viewer -->
    <section class="panel">
        <h2>
            Orchestrator Response
            <span class="pill">Agents · Synthesis</span>
        </h2>

        <div>
            <div class="small-label">Final answer</div>
            <div id="finalResponse" class="response-box">
                Run a request to see LifeVault orchestrator output here.
            </div>
        </div>

        <div>
            <div class="small-label" style="margin-bottom: 4px;">Agents involved</div>
            <div id="agentsList"></div>
        </div>
    </section>
</main>

<script>
    const ORCHESTRATOR_ENDPOINT = "http://localhost:3000/api/orchestrate";
    const MEAL_LOG_ENDPOINT = "https://lifevault-api.azurewebsites.net/api/logMeal";

    const runBtn = document.getElementById('runBtn');
    const exampleBtn = document.getElementById('exampleBtn');
    const inputText = document.getElementById('inputText');
    const persona = document.getElementById('persona');
    const intent = document.getElementById('intent');
    const userId = document.getElementById('userId');
    const statusText = document.getElementById('statusText');
    const finalResponse = document.getElementById('finalResponse');
    const agentsList = document.getElementById('agentsList');

    const mealLogBtn  = document.getElementById('mealLogBtn');
    const mealTypeSel = document.getElementById('mealType');
    const mealUserId  = document.getElementById('mealUserId');
    const mealItems   = document.getElementById('mealItems');
    const mealStatus  = document.getElementById('mealStatus');

    const startFastBtn = document.getElementById('startFastBtn');
    const endFastBtn   = document.getElementById('endFastBtn');
    const fastStatus   = document.getElementById('fastStatus');
    const fastStage    = document.getElementById('fastStage');

    let fastTimerInterval = null;

    function getFastingDescription(hours) {
        if (hours < 0.1) {
            return "You’re not in a fast yet. Once you start, you’ll see what’s happening in your body hour by hour based on typical intermittent fasting physiology.";
        } else if (hours < 4) {
            return "0–4 hours fasted: You’re in the post‑meal state. Digestion and absorption are active, blood sugar and insulin are elevated, and you’re primarily burning the food from your last meal. A mild ‘food coma’ or energy dip can happen if that meal was large or high in refined carbs.";
        } else if (hours < 8) {
            return "4–8 hours fasted: Insulin is falling and your body is finishing the last of the meal‑derived glucose. Your liver releases stored glycogen to keep blood sugar stable. Cravings often fade and energy becomes steadier than right after eating.";
        } else if (hours < 12) {
            return "8–12 hours fasted: You’re in a late post‑absorptive phase. Your body increasingly taps liver glycogen and starts ramping up fat breakdown. Growth‑supporting hormones rise relative to the fed state, helping preserve lean mass. Hunger usually comes in waves that pass if you ride them out for 10–20 minutes.";
        } else if (hours < 16) {
            return "12–16 hours fasted: You’re shifting more toward fat‑led metabolism. Glycogen is lower, so you’re burning more stored fat and producing more ketones. Many people experience clearer thinking and steadier focus here, with lower inflammatory signals than in a constant snacking pattern.";
        } else if (hours < 20) {
            return "16–20 hours fasted: You’re in a deeper fasting window. Fat burning is prominent, ketones provide more brain fuel, and cellular clean‑up processes like autophagy begin to ramp up compared with normal feeding. This is where a ‘fasting high’ is common—lighter body feeling, sharp mind, and less reactive hunger.";
        } else if (hours < 24) {
            return "20–24 hours fasted: You’re relying heavily on stored fat and ketones, with very low insulin and typically improved insulin sensitivity compared to frequent grazing. Stress‑response pathways help maintain alertness and protect lean tissue. Cellular repair and recycling processes are more active than baseline, one proposed mechanism for fasting’s long‑term health effects.";
        } else if (hours < 48) {
            return "24–48 hours fasted: You’re solidly in extended fasting. Fat and ketones are the dominant fuels, liver glycogen is largely depleted, and autophagy and other cellular recycling processes remain elevated compared with normal eating. Many people report pronounced mental clarity and a very light, empty‑but‑energized body sensation during this window.";
        } else if (hours < 72) {
            return "48–72 hours fasted: Ketone levels are typically high, and fat stores are the primary energy source. Cellular stress‑response pathways, including autophagy and antioxidant defenses, stay strongly engaged. This window is often associated with a deep internal reset feeling as your body continues prioritizing repair and cleanup over digestion.";
        } else if (hours < 168) {
            return "72 hours to 7 days fasted: You’re in prolonged water‑fast territory. Body fat becomes the main calorie source, ketones fuel most brain function, and multiple hormonal and cellular repair systems operate in a sustained, fasting‑adapted mode. This period is often described as a powerful reset for appetite, food habits, and the relationship between mental clarity and energy.";
        } else if (hours < 240) {
            return "7–10 days fasted: You are in a very deep, extended fasting state. Your metabolism is thoroughly adapted to running on stored fat and ketones, and long‑term repair‑oriented processes remain active. Many people notice a profound shift in how they perceive hunger, taste, and their overall sense of mental and emotional clarity during this phase.";
        } else {
            return "10+ days fasted: This represents an extreme duration where fat and ketones carry almost all energy needs and fasting‑adapted hormonal and cellular patterns are sustained over many days. It is often described as a period of intense inner reset, with ongoing emphasis on repair, conservation, and highly efficient use of body fuel reserves.";
        }
    }

    function updateFastingUI() {
        const stored = localStorage.getItem("lifevault.fastStart");
        if (!stored) {
            fastStatus.textContent = "Not fasting.";
            fastStage.textContent = "When you start a fast, you’ll see a time‑aligned description of what’s happening in your body across the fast.";
            return;
        }
        const startTime = new Date(stored);
        const now = new Date();
        const diffMs = now - startTime;
        if (diffMs <= 0) {
            fastStatus.textContent = "Not fasting.";
            fastStage.textContent = "When you start a fast, you’ll see a time‑aligned description of what’s happening in your body across the fast.";
            return;
        }
        const hours = diffMs / 3600000;
        const wholeHours = Math.floor(hours);
        const minutes = Math.floor((hours - wholeHours) * 60);

        fastStatus.textContent = `Fasting for ${wholeHours}h ${minutes}m (since ${startTime.toLocaleTimeString()}).`;
        fastStage.textContent = getFastingDescription(hours);
    }

    function startFastingTimer() {
        if (fastTimerInterval) clearInterval(fastTimerInterval);
        updateFastingUI();
        fastTimerInterval = setInterval(updateFastingUI, 60000);
    }

    document.addEventListener("DOMContentLoaded", () => {
        const stored = localStorage.getItem("lifevault.fastStart");
        if (stored) {
            startFastingTimer();
        } else {
            updateFastingUI();
        }
    });

    startFastBtn.addEventListener("click", () => {
        const nowIso = new Date().toISOString();
        localStorage.setItem("lifevault.fastStart", nowIso);
        startFastingTimer();
    });

    endFastBtn.addEventListener("click", () => {
        localStorage.removeItem("lifevault.fastStart");
        if (fastTimerInterval) clearInterval(fastTimerInterval);
        fastStatus.textContent = "Fast ended.";
        fastStage.textContent = "Fast ended. When you start a new fast, this panel will show your fasting physiology again.";
    });

    exampleBtn.addEventListener('click', () => {
        inputText.value = "Plan my next 7 days so I can make serious progress on LifeVault, stay on top of MSSA, and not burn out physically.";
        persona.value = "dev";
        intent.value = "plan_sprint";
        statusText.textContent = "Example loaded.";
    });

    runBtn.addEventListener('click', async () => {
        const text = inputText.value.trim();
        if (!text) {
            alert("Please enter a request for LifeVault.");
            return;
        }

        const payload = {
            userId: userId.value.trim() || "shane-dev-001",
            persona: persona.value,
            intent: intent.value,
            inputText: text,
            uiContext: {
                source: "web-console",
                version: "v1",
                timestamp: new Date().toISOString()
            }
        };

        runBtn.disabled = true;
        statusText.textContent = "Calling LifeVault orchestrator...";
        finalResponse.textContent = "Thinking...";
        agentsList.innerHTML = "";

        try {
            if (ORCHESTRATOR_ENDPOINT.includes("YOUR_ENDPOINT_HERE")) {
                await new Promise(r => setTimeout(r, 800));
                finalResponse.textContent =
                    "This is a demo response. Replace ORCHESTRATOR_ENDPOINT in console.html with your real Azure Function or API URL.\n\n" +
                    "Payload that would be sent:\n" + JSON.stringify(payload, null, 2);
                agentsList.innerHTML =
                    '<span class="badge">Vitality (simulated)</span>' +
                    '<span class="badge">Analytics (simulated)</span>' +
                    '<span class="badge">Memory (simulated)</span>' +
                    '<span class="badge">Wisdom (simulated)</span>';
                statusText.textContent = "Demo mode: endpoint not configured yet.";
            } else {
                const res = await fetch(ORCHESTRATOR_ENDPOINT, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    throw new Error("HTTP " + res.status + " " + res.statusText);
                }

                const data = await res.json();

                finalResponse.textContent = data.finalResponse || "(No finalResponse field returned.)";

                agentsList.innerHTML = "";
                if (Array.isArray(data.agentSummaries)) {
                    data.agentSummaries.forEach(a => {
                        const span = document.createElement("span");
                        span.className = "badge";
                        span.textContent = a.agent + (a.summary ? " – " + a.summary : "");
                        agentsList.appendChild(span);
                    });
                } else {
                    agentsList.innerHTML = '<span class="badge">No agent summary data.</span>';
                }

                statusText.textContent = "Response received.";
            }
        } catch (err) {
            console.error(err);
            finalResponse.textContent = "Error calling orchestrator: " + err.message;
            agentsList.innerHTML = '<span class="badge">Error</span>';
            statusText.textContent = "Error.";
        } finally {
            runBtn.disabled = false;
        }
    });

    mealLogBtn.addEventListener('click', async () => {
        const items = mealItems.value.trim();
        if (!items) {
            alert("Please enter what you ate.");
            return;
        }

        const userIdVal = mealUserId.value.trim() || "defaultuser";
        const mealType = mealTypeSel.value;

        const payload = {
            userId: userIdVal,
            timestamp: new Date().toISOString(),
            mealType,
            foodItems: items,
            gradeAnalysis: ""
        };

        mealLogBtn.disabled = true;
        mealStatus.textContent = "Logging meal...";

        try {
            const res = await fetch(MEAL_LOG_ENDPOINT, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (!res.ok) {
                throw new Error("HTTP " + res.status + " " + res.statusText);
            }

            const data = await res.json();
            mealStatus.textContent = "Meal logged! id=" + (data.id || "ok");
            mealItems.value = "";
        } catch (err) {
            console.error(err);
            mealStatus.textContent = "Error: " + err.message;
        } finally {
            mealLogBtn.disabled = false;
        }
    });
</script>
</body>
</html>
